/**
 * GooFlow - Web端流程设计器
 * @author foolegg126 (sdlddr)
 * @version v1.3.10
 * @license UNLICENSED
 **/
!function(e,t){"use strict";"undefined"!=typeof define&&define.amd?define(["jquery","GooFlow"],t):"undefined"!=typeof module&&module.exports?t(require("jquery"),require("GooFlow")):t(e.$,e.GooFlow)}("undefined"!=typeof window?window:this,function(d,h){"function"!==h.prototype._initGroup&&(h.prototype.$areaData={},h.prototype.$areaCount=0,h.prototype.$areaDom={},h.prototype._initGroup=function(){this.$group=d('<div class="GooFlow_work_group" style="width:100%;height:100%"></div>'),this.$workArea.prepend(this.$group),this.$editable&&(this.$group.on("contextmenu",".GooFlow_area",{inthis:this},function(e){var t=e.data.inthis;if("function"==typeof t.onItemRightClick&&!1===t.onItemRightClick(this.id,"area"))return window.event?window.event.returnValue=!1:e.preventDefault(),!1}),this.$group.on("mousedown",{inthis:this},function(e){if(2===e.button)return!1;var h=e.data.inthis;if("group"===h.$nowType){e||(e=window.event);var t=d(e.target).css("cursor"),n=e.target.parentNode;switch(t){case"nw-resize":case"w-resize":case"n-resize":n=n.parentNode;break;case"move":break;default:return}n=n.id,Goo.draw(),h.$ghost.css("cursor",t);var a=h.$areaData[n];e.id=n,h._bindMoveEvent(e,a,function(e,t,a,i,r,s,o){e&&("move"!==a?h.resizeArea(n,s,o):h.moveArea(n,i,r))},t,200,100)}}),setTimeout(function(){try{Goo.draw()}catch(e){document.write()}},1e4),this.$group.on("dblclick",{inthis:this},function(e){var t=e.data.inthis;if("group"===t.$nowType){if(e||(e=window.event),"LABEL"!==e.target.tagName)return!1;var a=e.target.parentNode;if("function"!=typeof t.onItemDbClick||!1!==t.onItemDbClick(a.id,"area")){var i=e.target.innerHTML,r=parseInt(a.style.left,10)+18,s=parseInt(a.style.top,10)+1,o=t.t;return t.$textArea.val(i).css({display:"block",width:130,height:26,left:o.left+r-t.$workArea[0].parentNode.scrollLeft,top:o.top+s-t.$workArea[0].parentNode.scrollTop}).data("id",a.id).focus(),t.$workArea.parent().one("mouseup",function(e){return 2===e.button||"block"===t.$textArea.css("display")&&(t.setName(t.$textArea.data("id"),t.$textArea.val(),"area"),t.$textArea.val("").removeData("id").hide()),!1}),!1}}}),this.$group.mouseup({inthis:this},function(e){var t=e.data.inthis;if("block"===t.$textArea.css("display"))return t.setName(t.$textArea.data("id"),t.$textArea.val(),"area"),t.$textArea.val("").removeData("id").hide(),!1;if("group"===t.$nowType){switch(e||(e=window.event),d(e.target).attr("class")){case"rs_close":return t.delArea(e.target.parentNode.parentNode.id),!1;case"bg":return}switch(e.target.tagName){case"LABEL":return!1;case"I":var a=e.target.parentNode.id;switch(t.$areaData[a].color){case"red":t.setAreaColor(a,"yellow");break;case"yellow":t.setAreaColor(a,"blue");break;case"blue":t.setAreaColor(a,"green");break;case"green":t.setAreaColor(a,"milk");break;case"milk":t.setAreaColor(a,"red")}return!1}if("none"===e.data.inthis.$ghost.css("display")){if(2===e.button)return!1;var i,r,s=h._mouseP(e),o=h._elCsys(this);i=s.x-o.left+this.parentNode.parentNode.scrollLeft,r=s.y-o.top+this.parentNode.parentNode.scrollTop;return t.addArea((new Date).getTime(),{name:t.$areaPrefix+e.data.inthis.$max,left:i/t.$scale,top:r/t.$scale,color:["red","yellow","blue","green","milk"][e.data.inthis.$max%5],width:200,height:100}),t.$max++,!1}}}))},h.prototype._areaFixNodes=function(e){var t=this.$areaData[e];for(var a in this.$nodeData){var i=this.$nodeData[a];i.left>=t.left&&i.left<t.left+t.width&&i.top>=t.top&&i.top<t.top+t.height?i.areaId=e:i.areaId&&i.areaId===e&&this._node2Area(a)}},h.prototype.addArea=function(e,t,a,i,r){if(!1===a||"function"!=typeof this.onItemAdd||!1!==this.onItemAdd(e,"area",t)){if(this.$undoStack&&!i&&this.$editable&&this.pushOper("delArea",[e]),this.$areaDom[e]=d("<div id='"+e+"' class='GooFlow_area area_"+t.color+"' style='top:"+t.top*this.$scale+"px;left:"+t.left*this.$scale+"px'><div class='bg' style='width:"+t.width*this.$scale+"px;height:"+t.height*this.$scale+"px'></div><label>"+t.name+"</label><i></i>"+(this.$editable?"<div><div class='rs_bottom'></div><div class='rs_right'></div><div class='rs_rb'></div><div class='rs_close'></div></div>":"")+"</div>"),this.$areaData[e]=t,this.$group.append(this.$areaDom[e]),1!==this.$scale){var s=16*this.$scale+2;this.$areaDom[e].find("label").css({"font-size":14*this.$scale+"px",left:s+3+"px"}).next("i").css({"font-size":s-2+"px",width:s+"px",height:s+"px","line-height":s+"px"})}"group"!==this.$nowType&&this.$areaDom[e].children("div:eq(1)").css("display","none"),++this.$areaCount,this.$editable&&(this.$areaData[e].alt=!0,this._areaFixNodes(e),this.$deletedItem[e]&&delete this.$deletedItem[e]),!r&&this.$navMap&&this.refreshMap()}},h.prototype.moveArea=function(e,t,a){if(this.$areaData[e]&&(null==this.onItemMove||this.onItemMove(e,"area",t,a))){if(this.$undoStack){var i=[e,this.$areaData[e].left,this.$areaData[e].top];this.pushOper("moveArea",i)}t<0&&(t=0),a<0&&(a=0),d("#"+e).css({left:t*this.$scale+"px",top:a*this.$scale+"px"}),this.$areaData[e].left=t,this.$areaData[e].top=a,this.$editable&&(this.$areaData[e].alt=!0,this._areaFixNodes(e)),this.$navMap&&this.refreshMap()}},h.prototype.delArea=function(e,t,a,i){if(this.$areaData[e]&&(!1===t||"function"!=typeof this.onItemDel||!1!==this.onItemDel(e,"area"))){if(this.$undoStack&&!a){var r=[e,this.$areaData[e]];this.pushOper("addArea",r)}if(delete this.$areaData[e],this.$areaDom[e].remove(),delete this.$areaDom[e],--this.$areaCount,this.$editable){for(var s in this.$nodeData){var o=this.$nodeData[s];o.areaId===e&&delete o.areaId}this.$deletedItem[e]="area"}!i&&this.$navMap&&this.refreshMap()}},h.prototype.setAreaColor=function(e,t){if(this.$areaData[e]&&("red"===t||"yellow"===t||"blue"===t||"green"===t||"milk"===t)){if(this.$undoStack){var a=[e,this.$areaData[e].color];this.pushOper("setAreaColor",a)}this.$areaDom[e].removeClass("area_"+this.$areaData[e].color).addClass("area_"+t),this.$areaData[e].color=t,this.$editable&&(this.$areaData[e].alt=!0),this.$navMap&&this.refreshMap()}},h.prototype.resizeArea=function(e,t,a){if(this.$areaData[e]&&("function"!=typeof this.onItemResize||!1!==this.onItemResize(e,"area",t,a))){if(this.$undoStack){var i=[e,this.$areaData[e].width,this.$areaData[e].height];this.pushOper("resizeArea",i)}Goo.draw(),this.$areaDom[e].children(".bg").css({width:t*this.$scale+"px",height:a*this.$scale+"px"}),t=this.$areaDom[e].outerWidth(),a=this.$areaDom[e].outerHeight(),this.$areaDom[e].children("bg").css({width:t+"px",height:a+"px"}),this.$areaData[e].width=t,this.$areaData[e].height=a,this.$editable&&(this.$areaData[e].alt=!0,this._areaFixNodes(e)),this.$navMap&&this.refreshMap()}})});